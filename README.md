# PyRamses
![Static Badge](https://img.shields.io/badge/TriOS-RAMSES-blue)
![Static Badge](https://img.shields.io/badge/NON_OFFICIAL-orange)
![Static Badge](https://img.shields.io/badge/NO_WARRANTY-green)

Python module to communicate with [TriOS RAMSES](https://www.trios.de/en/ramses.html) radiometers via serial port

## Features
- Trigger [TriOS RAMSES](https://www.trios.de/en/ramses.html) radiometers via serial communication.
- Comaptible with the .dat file generated by the MSDA_XE software.
- Tested on Windows 10 with [Python 3.10.11](https://www.python.org/downloads/release/python-31011/) (64bit)

## Dependency
- Python packages: [Numpy](https://numpy.org/), [Matplotlib](https://matplotlib.org/), [PySerial](https://pyserial.readthedocs.io/en/latest/index.html)
- Device configuration file: SAM_xxxx.ini
- Manufacturer calibration files: Back_SAM_xxxx.dat, Cal_SAM_xxxx.dat, CalAQ_SAM_xxxx.dat

## Demo
Run [PyRamses.py](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py) directly to go through a typical measuring workflow:
1. Function [ramses_dev_scan()](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py#L243) is called to scan all serial ports and to list out all available TriOS RAMSES devices.
2. Devices are distinguished by their serial numbers and each one is attached to an instance of the RAMSES class for further process.
3. Once attached to a device, the RAMSES object calls the internal function [config_parse()](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py#L312) to get the configuration information and calibration parameters from the device configuration file and manufacturer calibration files based on the serial number of the device.
4. A thread is assigned to listen to the serial port to which the TriOS RAMSES devices are connected, and the text received from the port is pushed in a queue for other threads to fetch. 
5. Another thread is assigned to monitor the size of the queue. When the queue is not empty, which means new message received from the devices, the raw message is logged and at the same time parsed by the internal function [rx_parse()](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py#L392) of each RAMSES object.
6. When the user consents to "Start measurement" by not typing "n", all the listed TriOS RAMSES devices will be triggered immediately for a one-time measurement.
7. The results of measurement from different devices is concatenated as a line of bytes and transmitted throught serial communication to be catched by the listener thread.
8. After parsed by RAMSES objects, the latest measured data for each device is interpreted and plotted (by overwriting) as a figure of spectrum for preview.
9. The user is asked whether to take the measurement again. If so, step 6-8 repeats until the user types "n" to finish the measurement session.
10. All the measured data is exported to a .dat file with the official format as generated by the MSDA_XE software, and spectra of the entire measurement are plotted in a single figure.

Parse a .dat file produced by the official MSDA_XE software to extract the recorded radiometric data:
1. Call function [ramses_parse()](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py#L122) with the argument *filePath* alone for a brief look at the properties (e.g., device ID and number of samples) of the dataset.
2. Call function [ramses_parse()](https://github.com/hbliu104/PyRamses/blob/main/PyRamses.py#L122) again with additional arguments *device*, *datatype*, *timestamp*, *ip* to extract data of a specific device and datatype (RAW or CALIBRATED), with or without timestamps and inclination+pressure information.

## Reference
- TriOS Data protocol in "D01-016en202204: TriOS RAMSES Operating Instructions", TriOS GmbH
- [PyTrios](https://github.com/StefanSimis/PyTrios) by Stefan Simis
